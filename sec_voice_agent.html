<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</title>
    <!-- Vapi SDK Global Import (Standard method to expose Vapi globally) -->
    <script src="https://unpkg.com/@vapi-ai/web@2.3.3/dist/index.umd.js"></script>

    <style>
        /* [CSS styles remain unchanged from previous versions] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* SEC Brand Colors */
        :root {
            --sec-blue: #004481; /* Deep Blue */
            --sec-orange: #F26724; /* Bright Orange */
            --shadow-color: rgba(0, 68, 129, 0.15);
        }

        /* Header */
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            position: relative;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--sec-blue) 0%, #1E5BA8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .logo-icon {
            width: 30px;
            height: 30px;
            border: 3px solid var(--sec-orange);
            border-radius: 50%;
            border-top-color: transparent;
            border-left-color: transparent;
        }

        .company-name {
            display: flex;
            flex-direction: column;
        }

        .company-name h1 {
            color: var(--sec-blue);
            font-size: 1.3rem;
            font-weight: 700;
        }

        .company-name p {
            color: var(--sec-orange);
            font-size: 0.9rem;
            margin-top: 2px;
        }

        .website-link {
            color: var(--sec-blue);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: color 0.3s;
        }

        .website-link:hover {
            color: var(--sec-orange);
        }

        /* Main Container */
        .container {
            flex: 1;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            width: 100%;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            padding: 3rem 2rem;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-header {
            margin-bottom: 2rem;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--sec-blue) 0%, #1E5BA8 100%);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .main-title {
            color: #2C3E50;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .subtitle {
            color: #7F8C8D;
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Voice Button Container */
        .voice-container {
            margin: 3rem 0;
            position: relative;
        }

        .pulse-ring {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(0, 68, 129, 0.1) 0%, rgba(242, 103, 36, 0.1) 100%);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 68, 129, 0.4);
            }
            70% {
                box-shadow: 0 0 0 30px rgba(0, 68, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(0, 68, 129, 0);
            }
        }

        /* Status */
        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: #7F8C8D;
            font-size: 1rem;
            margin: 2rem 0;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #95A5A6;
            border-radius: 50%;
        }

        .status.connecting .status-dot,
        .status.speaking .status-dot {
            background: var(--sec-orange);
            animation: blink 2s infinite;
        }

        .status.connected .status-dot {
             background: #27AE60;
             animation: none;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Action Button */
        .action-button {
            background: linear-gradient(135deg, var(--sec-blue) 0%, #1E5BA8 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px var(--shadow-color);
            margin-bottom: 2rem;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 68, 129, 0.4);
        }

        .action-button:active {
            transform: translateY(0);
        }

        /* Quick Actions */
        .quick-actions {
            border-top: 1px solid #E8EEF5;
            padding-top: 2rem;
            margin-top: 2rem;
        }

        .quick-actions-title {
            color: #7F8C8D;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .quick-action-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #E8EEF5 100%);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: right;
        }

        .quick-action-card:hover {
            transform: translateY(-3px);
            border-color: var(--sec-blue);
            box-shadow: 0 6px 20px rgba(0, 68, 129, 0.15);
        }

        .quick-action-title {
            color: #2C3E50;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .quick-action-desc {
            color: #7F8C8D;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* Footer */
        .footer {
            background: white;
            padding: 1.5rem 2rem;
            text-align: center;
            color: #7F8C8D;
            font-size: 0.9rem;
            border-top: 1px solid #E8EEF5;
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .main-title {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .card {
                padding: 2rem 1.5rem;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <!-- SEC Logo Icon placeholder (can be replaced with actual SVG or image) -->
                    <div class="logo-icon"></div>
                </div>
                <div class="company-name">
                    <h1>Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡</h1>
                    <p>Ù†Ø¹Ù…Ù„ Ø¨Ø¥ØªÙ‚Ø§Ù† Ù…Ù† Ø£Ø¬Ù„ÙƒÙ…</p>
                </div>
            </div>
            <a href="https://www.se.com.sa" class="website-link" target="_blank">www.se.com.sa</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="badge">ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</div>
                <h2 class="main-title">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                <p class="subtitle">
                    Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ø§Ù„ÙÙˆØ§ØªÙŠØ±ØŒ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§ØªØŒ ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ÙÙ†ÙŠØ©
                </p>
            </div>

            <div class="voice-container">
                <div class="pulse-ring">
                    <!-- Microphone SVG Icon -->
                    <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
                        <circle cx="50" cy="50" r="40" fill="url(#gradient)" />
                        <path d="M50 30 C50 30 42 35 42 45 L42 55 C42 65 50 70 50 70 C50 70 58 65 58 55 L58 45 C58 35 50 30 50 30 Z" fill="white"/>
                        <rect x="47" y="70" width="6" height="10" fill="white"/>
                        <rect x="40" y="78" width="20" height="4" rx="2" fill="white"/>
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="100" y2="100">
                                <stop offset="0%" style="stop-color:var(--sec-blue);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:var(--sec-orange);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
            </div>

            <div class="status" id="status">
                <span class="status-dot"></span>
                <span>ØºÙŠØ± Ù…ØªØµÙ„</span>
            </div>

            <button class="action-button" id="startButton" onclick="startConversation()">
                ğŸ™ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            </button>

            <div class="quick-actions">
                <div class="quick-actions-title">
                    âš¡ Ø¬Ø±Ø¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                </div>
                <div class="quick-actions-grid">
                    <div class="quick-action-card" data-prompt="Ù„ÙŠØ´ ÙØ§ØªÙˆØ±ØªÙŠ Ø§Ø±ØªÙØ¹Øª Ù‡Ø§Ù„Ø´Ù‡Ø±ØŸ">
                        <div class="quick-action-title">Ù„ÙŠØ´ ÙØ§ØªÙˆØ±ØªÙŠ Ø§Ø±ØªÙØ¹Øª Ù‡Ø§Ù„Ø´Ù‡Ø±ØŸ</div>
                        <div class="quick-action-desc">Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ø±ØªÙØ§Ø¹ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø©</div>
                    </div>
                    <div class="quick-action-card" data-prompt="Ø¹Ù†Ø¯ÙŠ Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¨Ø§Ù„Ø¨ÙŠØª">
                        <div class="quick-action-title">Ø¹Ù†Ø¯ÙŠ Ø§Ù†Ù‚Ø·Ø§Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¨Ø§Ù„Ø¨ÙŠØª</div>
                        <div class="quick-action-desc">Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ ÙˆÙØªØ­ Ø¨Ù„Ø§Øº</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Â© 2024 Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </div>


    <script>
        // Vapi Configuration
        const VAPI_PUBLIC_KEY = '1f2432da-8fee-4c9e-af48-674fa145d001';
        const ASSISTANT_ID = 'e2a656f8-5bfc-4cb1-993d-9db82a69bd79';

        // UI Elements
        const startButton = document.getElementById('startButton');
        const statusEl = document.getElementById('status');

        let vapi = null;
        let isCallActive = false;
        let isVapiInitialized = false;

        // --- UI Update Functions ---
        function updateStatus(state) {
            statusEl.classList.remove('connected', 'connecting', 'speaking');

            switch (state) {
                case 'connecting':
                    statusEl.classList.add('connecting');
                    statusEl.innerHTML = `<span class="status-dot"></span><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>`;
                    break;
                case 'connected':
                    statusEl.classList.add('connected');
                    statusEl.innerHTML = `<span class="status-dot"></span><span>Ù…ØªØµÙ„ - ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†</span>`;
                    break;
                case 'speaking':
                    statusEl.classList.add('speaking');
                    statusEl.innerHTML = `<span class="status-dot"></span><span>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙŠØªØ­Ø¯Ø«...</span>`;
                    break;
                case 'error':
                    statusEl.innerHTML = `<span class="status-dot" style="background: red;"></span><span>ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„.</span>`;
                    break;
                case 'idle':
                default:
                    statusEl.innerHTML = `<span class="status-dot"></span><span>ØºÙŠØ± Ù…ØªØµÙ„</span>`;
                    break;
            }
        }

        function updateButton(isActive) {
            if (isActive) {
                startButton.textContent = 'â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©';
                // Stop button color (Red gradient)
                startButton.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
            } else {
                startButton.textContent = 'ğŸ™ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';
                // Start button color (SEC Blue gradient)
                startButton.style.background = 'linear-gradient(135deg, var(--sec-blue) 0%, #1E5BA8 100%)';
            }
            startButton.disabled = false;
        }

        // --- Vapi Initialization and Event Listeners ---
        function initializeVapiAndListeners() {
            if (isVapiInitialized) return;

            // Check if Vapi object is globally available (should be due to CDN script tag)
            if (typeof Vapi === 'undefined') {
                updateStatus('error');
                console.error("Vapi SDK is not available. Please check the CDN link.");
                startButton.disabled = true;
                return;
            }

            try {
                // Instantiate Vapi only once
                vapi = new Vapi(VAPI_PUBLIC_KEY);

                vapi.on('call-start', () => {
                    isCallActive = true;
                    updateButton(true);
                    updateStatus('connected');
                });

                vapi.on('call-end', () => {
                    isCallActive = false;
                    updateButton(false);
                    updateStatus('idle');
                });

                vapi.on('speech-start', () => {
                    updateStatus('speaking');
                });

                vapi.on('speech-end', () => {
                    updateStatus('connected');
                });

                vapi.on('error', (error) => {
                    console.error('Vapi error:', error);
                    isCallActive = false;
                    updateButton(false);
                    updateStatus('error');
                });

                isVapiInitialized = true;
                console.log('Vapi SDK Initialized successfully.');

            } catch (error) {
                console.error('Error during Vapi SDK instantiation:', error);
                updateStatus('error');
                startButton.disabled = true;
            }
        }

        // --- Main Conversation Toggler (Exposed to Global Scope) ---
        async function startConversation(prompt = null) {
            startButton.disabled = true;

            // 1. Initialize Vapi if not already done
            if (!isVapiInitialized) {
                initializeVapiAndListeners();
                if (!isVapiInitialized) {
                    // Failed to initialize, stop here
                    startButton.disabled = false;
                    return;
                }
            }

            if (isCallActive) {
                // End the call
                vapi.stop();
                updateStatus('idle');
                updateButton(false);
            } else {
                // Start the call
                try {
                    updateStatus('connecting');

                    let callConfig = { assistantId: ASSISTANT_ID };

                    if (prompt) {
                        // If a quick action prompt is provided, start the conversation with it
                        callConfig.config = {
                            model: {
                                systemPrompt: `You are an AI assistant for the Saudi Electricity Company (SEC). The user has clicked a quick action button. Start the conversation by acknowledging their prompt and immediately addressing it. The user's prompt is: "${prompt}"`,
                            },
                        };
                    }
                    
                    // The vapi object is guaranteed to be initialized here
                    await vapi.start(ASSISTANT_ID, callConfig.config);

                    // Call start event listener will handle UI update
                } catch (error) {
                    console.error('Error starting call:', error);
                    updateStatus('error');
                    updateButton(false);
                }
            }
            startButton.disabled = false;
        }

        // --- Quick Action Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.quick-action-card').forEach(card => {
                card.addEventListener('click', function() {
                    if (!isCallActive) {
                        const prompt = this.getAttribute('data-prompt');
                        startConversation(prompt);
                    }
                });
            });

            // Attempt initialization immediately after DOM content loads (optional, but good practice)
            // initializeVapiAndListeners(); // Let's keep it lazy (on button click) for max compatibility
        });

        // The function is globally available because it's in a standard <script> tag now.
    </script>
</body>
</html>
